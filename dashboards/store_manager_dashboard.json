{
  "version": "v2",
  "dashboard": {
    "display_name": "Store Manager Cockpit",
    "description": "Real-time operational dashboard for store managers with sales performance, inventory alerts, and customer metrics",
    "tags": ["retail", "store-operations", "real-time"],
    "widgets": [
      {
        "id": "sales_kpis",
        "title": "Today's Sales Performance",
        "description": "Key sales metrics for today vs targets",
        "widget_type": "counter",
        "position": {
          "size_x": 6,
          "size_y": 2,
          "row": 0,
          "col": 0
        },
        "options": {
          "counterLabel": "Today's Sales",
          "counterValue": "SELECT COALESCE(SUM(total_sales), 0) as today_sales FROM daily_sales_agg WHERE sale_date = CURRENT_DATE() AND store_id = '{{ store_filter }}'"
        }
      },
      {
        "id": "sales_target",
        "title": "Sales vs Target",
        "description": "Performance against daily target",
        "widget_type": "counter",
        "position": {
          "size_x": 6,
          "size_y": 2,
          "row": 0,
          "col": 6
        },
        "options": {
          "counterLabel": "Target Achievement",
          "counterValue": "SELECT ROUND(avg_daily_sales / daily_sales_target * 100, 1) as target_pct FROM store_performance WHERE store_id = '{{ store_filter }}'"
        }
      },
      {
        "id": "daily_trend",
        "title": "Daily Sales Trend (Last 30 Days)",
        "description": "Sales performance over time",
        "widget_type": "chart",
        "position": {
          "size_x": 12,
          "size_y": 4,
          "row": 2,
          "col": 0
        },
        "options": {
          "globalSeriesType": "line",
          "xAxis": {
            "type": "datetime",
            "labels": {
              "enabled": true
            }
          },
          "yAxis": [
            {
              "type": "linear"
            }
          ],
          "series": {
            "stacking": null
          }
        },
        "query": "SELECT sale_date, SUM(total_sales) as daily_sales FROM daily_sales_agg WHERE sale_date >= CURRENT_DATE() - INTERVAL 30 DAYS AND store_id = '{{ store_filter }}' GROUP BY sale_date ORDER BY sale_date"
      },
      {
        "id": "critical_alerts",
        "title": "Critical Inventory Alerts",
        "description": "Items requiring immediate attention",
        "widget_type": "table",
        "position": {
          "size_x": 6,
          "size_y": 4,
          "row": 6,
          "col": 0
        },
        "query": "SELECT product_name, alert_type, ending_inventory, days_since_last_sale FROM inventory_alerts_materialized WHERE store_id = '{{ store_filter }}' AND priority = 'CRITICAL' ORDER BY ending_inventory ASC LIMIT 10"
      },
      {
        "id": "top_products",
        "title": "Top Performing Products (Last 7 Days)",
        "description": "Best sellers by revenue",
        "widget_type": "table",
        "position": {
          "size_x": 6,
          "size_y": 4,
          "row": 6,
          "col": 6
        },
        "query": "SELECT p.product_name, SUM(s.total_amount) as revenue, SUM(s.quantity) as units_sold FROM sales s JOIN products p ON s.product_id = p.product_id WHERE s.sale_date >= CURRENT_DATE() - INTERVAL 7 DAYS AND s.store_id = '{{ store_filter }}' GROUP BY p.product_name ORDER BY revenue DESC LIMIT 10"
      },
      {
        "id": "hourly_performance",
        "title": "Today's Hourly Sales Pattern",
        "description": "Sales by hour to optimize staffing",
        "widget_type": "chart",
        "position": {
          "size_x": 6,
          "size_y": 3,
          "row": 10,
          "col": 0
        },
        "options": {
          "globalSeriesType": "column",
          "xAxis": {
            "type": "category",
            "labels": {
              "enabled": true
            }
          }
        },
        "query": "SELECT HOUR(sale_timestamp) as hour, SUM(total_amount) as hourly_sales FROM sales WHERE sale_date = CURRENT_DATE() AND store_id = '{{ store_filter }}' GROUP BY HOUR(sale_timestamp) ORDER BY hour"
      },
      {
        "id": "customer_metrics",
        "title": "Customer Metrics Today",
        "description": "Traffic and conversion metrics",
        "widget_type": "table",
        "position": {
          "size_x": 6,
          "size_y": 3,
          "row": 10,
          "col": 6
        },
        "query": "SELECT COUNT(DISTINCT transaction_id) as transactions, COUNT(DISTINCT customer_id) as unique_customers, AVG(total_amount) as avg_transaction, SUM(CASE WHEN return_flag THEN 1 ELSE 0 END) as returns FROM sales WHERE sale_date = CURRENT_DATE() AND store_id = '{{ store_filter }}'"
      }
    ],
    "parameters": [
      {
        "name": "store_filter",
        "type": "query-based-dropdown-list",
        "title": "Store",
        "queryId": "store_list_query",
        "multiValuesOptions": {
          "enabled": false,
          "separator": ","
        }
      }
    ],
    "queries": [
      {
        "id": "store_list_query",
        "name": "Store List",
        "query": "SELECT store_id as value, store_name as name FROM stores WHERE status = 'Active' ORDER BY store_name",
        "data_source_id": "{{ warehouse_id }}"
      }
    ],
    "refresh_schedule": {
      "interval": 300,
      "until": null
    }
  }
}